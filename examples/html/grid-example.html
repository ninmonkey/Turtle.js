<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turtle.js</title>
    <link rel="stylesheet" href="./../css/main-grid.css" type="text/css">
    <style>
        :root {
            /* --bg-primary-1: #2e353d; */
        }
    </style>
</head>

<body>
    <section>
        <nav>
            <ul>
                <li><a href="./">Go Back</a></li>
                <li><a href="#" id="cmd-btn-toggle-grid-large">Large / Small</a></li>
            </ul>
        </nav>
    </section>
    <section class="parent-context grid-small">
        <turtle-svg id="turtle-1" popovertarget="tooltip-1" popovertargetaction="toggle">

            <span slot="title">Turtle.js</span>
        </turtle-svg>

    </section>

    <!-- shown when clicking '#button-bar button' -->
    <!--
    <div id="submenu-1" popover="auto">
        <button>Option A</button><br /><button>Option B</button>
    </div>
    -->

    <!-- element shown when hovering the "popovertarget" on "#button-bar button"-->
    <div id="tooltip-1" class="tooltip" popover="hint">Tooltip A</div>
    <!--
    Press the buttons to show the auto popovers. Hover or focus the buttons to show the hint popovers. When an auto popover is shown, you can show the hint popovers without hiding it.
    ex: https://developer.mozilla.org/en-US/docs/Web/API/Popover_API/Using#using_hint_popover_state
    -->

    <script type="module">
        import { Turtle } from './../../js/turtle.js';
        import { TurtleSvgElement } from './../../js/custom-element/turtle-svg-element.js';
        import { ElementFromIdOrValue } from './../../js/utils.js'
        import { GetAllElements } from './../../js/debug_utils.js'



        let turt = new Turtle();
        const tse = new TurtleSvgElement()
        const dest = document.querySelector( ".parent-context" )
        dest.appendChild( tse )

        window.t1 = turt
        window.t2 = tse
        window.t3 = dest
        window.dbg_all = GetAllElements

        console.warn('tooltip hooks disabled')
        // t1.rotate(30).forward(4).rotate(66).forward(7)

        for( let i=0; i<7; i++ ) {
            const TurtleElem = new TurtleSvgElement()
            dest.appendChild( TurtleElem )
        }

        /* page specific handlers for `grid-example.html` */
        const toggleGridSizeButton = document.getElementById( "cmd-btn-toggle-grid-large" );
        toggleGridSizeButton.addEventListener( "click", () => {
            const target = document.querySelector( 'section.parent-context' )
            if ( target.classList.contains( "grid-large" ) ) {
                target.classList.replace( "grid-large", 'grid-small' )
            } else {
                target.classList.remove( "grid-small" )
                target.classList.add( "grid-large" )
            }
        } );



        if ( false ) {

            const t_first = document.querySelectorAll( 'turtle-svg' )[ 0 ]
            t_first.shadowRoot.querySelector( 'svg.svg-root' )

            InitTurtle( {
                context: t_first.shadowRoot.querySelector( 'svg.svg-root' ),
                textContext: t_first.shadowRoot.querySelector( '.fps-counter' )
            } )

            const toggleGridSizeButton = document.getElementById( "cmd-btn-toggle-grid-large" );
            toggleGridSizeButton.addEventListener( "click", () => {
                const target = document.querySelector( 'section.parent-context' )
                if ( target.classList.contains( "grid-large" ) ) {
                    target.classList.replace( "grid-large", 'grid-small' )
                } else {
                    target.classList.remove( "grid-small" )
                    target.classList.add( "grid-large" )
                }
            } );


            // tooltips
            const tooltips = document.querySelectorAll( ".tooltip" );
            const btns = document.querySelectorAll( "#button-bar button" );


            function RegisterTooltipsForTurtleSvgElements ( turtleSvgElements ) {
                turtleSvgElements.forEach( ( turtleSvgElem ) => {
                    turtleSvgElem.addEventListener( "mouseover", () => {
                        const cur_tip = tooltips[ 0 ]
                        const cur = turtleSvgElem.shadowRoot.querySelector( 'svg' )
                        cur_tip.innerText =
                            `Viewbox: ${ cur.getAttribute( 'viewBox' ) }
                        X, Y: ${ cur.getAttribute( 'x' ) }, ${ cur.getAttribute( 'y' ) }.
                        Width, Height (attr):d ${ cur.getAttribute( 'width' ) } x ${ cur.getAttribute( 'height' ) }
                        Val Width, Height (baseVal): ${ cur.width.baseVal.value } x ${ cur.height.baseVal.value }

                        OuterHTML:
                            ${ cur.outerHTML }
                        \n`

                        cur_tip.showPopover( { source: turtleSvgElem } );
                    } );

                    turtleSvgElem.addEventListener( "mouseout", () => {
                        const cur_tip = tooltips[ 0 ]
                        cur_tip.hidePopover();
                    } );

                    turtleSvgElem.addEventListener( "focus", () => {
                        const cur_tip = tooltips[ 0 ]
                        cur_tip.showPopover( { source: turtleSvgElem } );
                    } );

                    turtleSvgElem.addEventListener( "blur", () => {
                        const cur_tip = tooltips[ 0 ]
                        cur_tip.hidePopover();
                    } );
                } )
            }

            const turtleSvgElements = document.querySelectorAll( 'turtle-svg' )
            RegisterTooltipsForTurtleSvgElements( turtleSvgElements )


            // globals
            window.bag ??= {}
            window.Turtle = Turtle

            window.Turtle = Turtle
            window.TurtleSvgElement = TurtleSvgElement
            window.turt = turt
            window.t = turt
            window.InitTurtle = InitTurtle
            // window.turtSvg = document.getElementById("turtle-svg")
            // window.svgPath = window.turtSvg.getElementById("turtle-path")
            window.bag.tse = tse
            window.bag.dest = dest

            console.trace( 'debug globals: ', { Turtle, TurtleSvgElement, turt, InitTurtle } )

            function Page_AddTooltipEventListenersForCommandBar ( i ) {
                // no longer wanted / to remove
                btns[ i ].addEventListener( "mouseover", () => {
                    tooltips[ i ].showPopover( { source: btns[ i ] } );
                } );

                btns[ i ].addEventListener( "mouseout", () => {
                    tooltips[ i ].hidePopover();
                } );

                btns[ i ].addEventListener( "focus", () => {
                    tooltips[ i ].showPopover( { source: btns[ i ] } );
                } );

                btns[ i ].addEventListener( "blur", () => {
                    tooltips[ i ].hidePopover();
                } );
            }

            for ( let i = 0; i < btns.length; i++ ) {
                Page_AddTooltipEventListenersForCommandBar( i );
            }
        }



    </script>


</body>

</html>