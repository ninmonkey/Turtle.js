<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turtle.js</title>
    <link rel="stylesheet" href="./../css/main-grid.css" type="text/css">
    <style>
        :root {
            /* --bg-primary-1: #2e353d; */
        }


    </style>
</head>

<body>
    <section>
        <nav>
            <ul>
                <li><a href="./">Go Back</a></li>
                <li><a href="#" id="cmd-btn-toggle-grid-large">Large / Small</a></li>
            </ul>
        </nav>
    </section>
    <section class="parent-context grid-small">
        <turtle-svg
            id="turtle-1"
            popovertarget="tooltip-1"
            popovertargetaction="toggle"

        >

           <span slot="title">Turtle.js</span>
        </turtle-svg>

    </section>

    <!-- shown when clicking '#button-bar button' -->
    <!--
    <div id="submenu-1" popover="auto">
        <button>Option A</button><br /><button>Option B</button>
    </div>
    -->

    <!-- element shown when hovering the "popovertarget" on "#button-bar button"-->
    <div id="tooltip-1" class="tooltip" popover="hint">
        <div>dsfds</div>
        <div>dsfds</div>
        Tooltip A</div>
    <!--
    Press the buttons to show the auto popovers. Hover or focus the buttons to show the hint popovers. When an auto popover is shown, you can show the hint popovers without hiding it.
    ex: https://developer.mozilla.org/en-US/docs/Web/API/Popover_API/Using#using_hint_popover_state
    -->

    <script type="module">
        import { InitTurtle, Turtle } from './../../js/turtle.js';
        import { TurtleSvgElement } from './../../js/custom-element/turtle-svg-element.js';
        import { ElementFromIdOrValue } from './../../js/utils.js'

        let turt = new Turtle();
        const tse = new TurtleSvgElement()
        const dest = document.querySelector( ".parent-context" )
        dest.appendChild( tse )

        const t_first = document.querySelectorAll( 'turtle-svg' )[ 0 ]
        t_first.shadowRoot.querySelector( 'svg.svg-root' )

        InitTurtle( {
            context: t_first.shadowRoot.querySelector( 'svg.svg-root' ),
            textContext: t_first.shadowRoot.querySelector( '.fps-counter' )
        } )

        const toggleGridSizeButton = document.getElementById("cmd-btn-toggle-grid-large");
        toggleGridSizeButton.addEventListener("click", () => {
            const target = document.querySelector('section.parent-context')
            if( target.classList.contains("grid-large") ) {
                target.classList.replace("grid-large", 'grid-small')
            } else {
                target.classList.remove("grid-small")
                target.classList.add("grid-large")
            }
        });


        // tooltips
        const tooltips = document.querySelectorAll(".tooltip");
            const btns = document.querySelectorAll("#button-bar button");


        function RegisterTooltipsForTurtleSvgElements( turtleSvgElements ) {
            turtleSvgElements.forEach((turtleSvgElem) => {
                turtleSvgElem.addEventListener("mouseover", () => {
                    const ttip = tooltips[0]
                    // update tooltip
                    // const from = document.querySelectorAll('turtle-svg')[0]
                    // const to = turtleSvgElem
                    // from.shadowRoot.querySelector('svg').outerHTML
                    // wrap content in a pre tag to preserve formatting
                    // const xmlText = turtleSvgElem.shadowRoot.querySelector('svg').outerHTML
                    const cur = turtleSvgElem.shadowRoot.querySelector('svg')
                    ttip.innerText =
                        `Viewbox: ${ cur.getAttribute('viewBox') }
                        X, Y: ${ cur.getAttribute('x') }, ${ cur.getAttribute('y') }.
                        Width, Height (attr): ${ cur.getAttribute('width') } x ${ cur.getAttribute('height') }
                        Val Width, Height (baseVal): ${ cur.width.baseVal.value } x ${ cur.height.baseVal.value }

                        OuterHTML:
                            ${ cur.outerHTML }
                        \n`

                    ttip.showPopover({ source: turtleSvgElem });
                });

                turtleSvgElem.addEventListener("mouseout", () => {
                    tooltips[0].hidePopover();
                });

                turtleSvgElem.addEventListener("focus", () => {
                    tooltips[0].showPopover({ source: turtleSvgElem });
                });

                turtleSvgElem.addEventListener("blur", () => {
                    tooltips[0].hidePopover();
                });
            })
        }

        const turtleSvgElements = document.querySelectorAll('turtle-svg')
        RegisterTooltipsForTurtleSvgElements( turtleSvgElements )


        // globals
        window.bag ??= {}
        window.Turtle = Turtle

        window.Turtle = Turtle
        window.TurtleSvgElement = TurtleSvgElement
        window.turt = turt
        window.t = turt
        window.InitTurtle = InitTurtle
        // window.turtSvg = document.getElementById("turtle-svg")
        // window.svgPath = window.turtSvg.getElementById("turtle-path")
        window.bag.tse = tse
        window.bag.dest = dest

        console.trace('debug globals: ', { Turtle, TurtleSvgElement, turt, InitTurtle })

        function Page_AddTooltipEventListenersForCommandBar(i) {
            // no longer wanted / to remove
            btns[i].addEventListener("mouseover", () => {
                tooltips[i].showPopover({ source: btns[i] });
            });

            btns[i].addEventListener("mouseout", () => {
                tooltips[i].hidePopover();
            });

            btns[i].addEventListener("focus", () => {
                tooltips[i].showPopover({ source: btns[i] });
            });

            btns[i].addEventListener("blur", () => {
                tooltips[i].hidePopover();
            });
        }

        for (let i = 0; i < btns.length; i++) {
            Page_AddTooltipEventListenersForCommandBar(i);
        }



    </script>


</body>

</html>