<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turtle.js</title>
    <link rel="stylesheet" href="./../css/main-grid.css" type="text/css">
    <link href="./../css/prism.css" rel="stylesheet" />
    <style>
        :root {
            /* --bg-primary-1: #2e353d; */
        }
        .inline-code-block {
            display: inline-block;
            padding: 0.2rem 0.4rem;
            background-color: var(--section-bg-color);
            border-radius: 3px;
            font-family: var(--font-sans);
            font-size: 0.9rem;
            color: var(--text-color);
            max-width: 180ch;
            margin: min(10vw, 30px) auto;
        }
    </style>
</head>

<body>
    <section>
        <nav>
            <ul>
                <li><a href="./">Go Back</a></li>
                <li><a href="#" id="cmd-btn-toggle-grid-large">Large / Small</a></li>
            </ul>
        </nav>
    </section>
    <section class="parent-context grid-small">
        <!-- <turtle-svg id="turtle-1" popovertarget="tooltip-1" popovertargetaction="toggle">
            <span slot="title">First</span>
        </turtle-svg> -->
    </section>

    <!-- shown when clicking '#button-bar button' -->
    <!--
    <div id="submenu-1" popover="auto">
        <button>Option A</button><br /><button>Option B</button>
    </div>
    -->

    <!-- element shown when hovering the "popovertarget" on "#button-bar button"-->
    <div id="tooltip-1" class="tooltip" popover="hint">Tooltip A</div>
    <!--
    Press the buttons to show the auto popovers. Hover or focus the buttons to show the hint popovers. When an auto popover is shown, you can show the hint popovers without hiding it.
    ex: https://developer.mozilla.org/en-US/docs/Web/API/Popover_API/Using#using_hint_popover_state
    -->

    <script type="module">
        import { Turtle } from './../../js/turtle.js';
        import { TurtleSvgElement } from './../../js/custom-element/turtle-svg-element.js';
        import { randomInt, elementFromIdOrValue, simpleFormatHtmlWhitespace, simpleEscapeHtml } from './../../js/utils.js'
        import { GetAllElements } from './../../js/debug_utils.js'

        const parentElement = document.querySelector( ".parent-context" )

        const t1_elem = new TurtleSvgElement()
        const turt1 = t1_elem.Turtle
        parentElement.appendChild( t1_elem )
        t1_elem.Title = 'Rand Polygon 1'
        turt1
            .polygon( 10, randomInt(4, 10) )
            // .updateSvg()

        const t2_elem = new TurtleSvgElement()
        const turt2 = t2_elem.Turtle
        parentElement.appendChild( t2_elem )
        t2_elem.Title = 'Rand Polygon 2'
        turt2
            .polygon( 10, randomInt(4, 10) )
            .updateSvg()

        /* example chaining
            dbg_all().turtleSvg[0].Turtle.rotate(20).forward(10).updateSvg().rotate(20).forward(34)
        */

        /* page specific handlers for `grid-example.html` */
        const toggleGridSizeButton = document.getElementById( "cmd-btn-toggle-grid-large" );
        toggleGridSizeButton.addEventListener( "click", () => {
            const target = document.querySelector( 'section.parent-context' )
            if ( target.classList.contains( "grid-large" ) ) {
                target.classList.replace( "grid-large", 'grid-small' )
            } else {
                target.classList.remove( "grid-small" )
                target.classList.add( "grid-large" )
            }
        } );


        // tooltips
        const tooltips = document.querySelectorAll( ".tooltip" );
        const btns = document.querySelectorAll( "#button-bar button" );

        function RegisterTooltipsForTurtleSvgElements ( turtleSvgElements ) {
            turtleSvgElements.forEach( ( turtleSvgElem ) => {
                turtleSvgElem.addEventListener( "mouseover", () => {
                    const cur_tip = tooltips[ 0 ]
                    const cur = turtleSvgElem.shadowRoot.querySelector( 'svg' )
                    const formatted_xml = simpleFormatHtmlWhitespace( cur.outerHTML )
                    const escaped_xml =
                        simpleEscapeHtml( formatted_xml )
                        // formatted_xml
                        //     // .replace( /\s{2,}/g, '')
                        //     .replace( /&/g, '&amp;' )
                        //     .replace( /</g, '&lt;' )
                        //     .replace( />/g, '&gt;' )
                        //     .replace( /"/g, '&quot;' )
                        //     .replace( /'/g, '&#039;' )
                        //     .replace( /^\s+/, '')
                        //     .replaceAll( /\n{2,}/g, '\n') // collapse newlines
                    const rawText = `
                    <p>
                    Viewbox: ${ cur.getAttribute( 'viewBox' ) }
                    <br/>X, Y: ${ cur.getAttribute( 'x' ) }, ${ cur.getAttribute( 'y' ) }.
                    <br/>Width, Height (attr):d ${ cur.getAttribute( 'width' ) } x ${ cur.getAttribute( 'height' ) }
                    <br/>Val Width, Height (baseVal): ${ cur.width.baseVal.value } x ${ cur.height.baseVal.value }
                    </p>
                    <p>Svg:</p><pre class="inline-code-block"><code class="language-xml">${
  escaped_xml
}</code></pre>`
                    cur_tip.innerHTML = rawText

                    window.Prism.highlightAll()
                    cur_tip.showPopover( { source: turtleSvgElem } );
                } );

                turtleSvgElem.addEventListener( "mouseout", () => {
                    const cur_tip = tooltips[ 0 ]
                    cur_tip.hidePopover();
                } );

                turtleSvgElem.addEventListener( "focus", () => {
                    const cur_tip = tooltips[ 0 ]
                    cur_tip.showPopover( { source: turtleSvgElem } );
                } );

                turtleSvgElem.addEventListener( "blur", () => {
                    const cur_tip = tooltips[ 0 ]
                    cur_tip.hidePopover();
                } );
            } )
        }

        const all_turtle_elements = document.querySelectorAll( 'turtle-svg' )
        RegisterTooltipsForTurtleSvgElements( all_turtle_elements )

        // globals
        window.bag ??= {}
        window.Turtle = Turtle
        window.TurtleSvgElement = TurtleSvgElement
        window.bag.root_elem = parentElement
        window.bag.all_turt_elements = all_turtle_elements

        // window.t1 = turt
        // window.t3 = dest
        window.dbg_all = GetAllElements
        console.trace( 'debug enabled globals: ', { Turtle, TurtleSvgElement, bag } )
    </script>
    <script src="../../js/prism.js"></script>


</body>

</html>