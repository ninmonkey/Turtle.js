<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examples - Turtle.js</title>
    <link rel="stylesheet" href="./../css/main-grid.css" type="text/css">
    <link href="./../css/prism.css" rel="stylesheet" />
    <style>
        :root {
            /* --bg-primary-1: #2e353d; */
        }

        .inline-code-block {
            display: inline-block;
            padding: 0.2rem 0.4rem;
            background-color: var(--section-bg-color);
            border-radius: 3px;
            font-family: var(--font-sans);
            font-size: 0.9rem;
            color: var(--text-color);
            max-width: 180ch;
            margin: min(10vw, 30px) auto;
        }
    </style>
</head>

<body>
    <section>
        <nav>
            <ul>
                <li><a href="./">Go Back</a></li>
                <li><a href="#" id="cmd-btn-toggle-grid-large">Large / Small</a></li>
            </ul>
        </nav>
    </section>
    <section class="parent-context grid-small">
        <!-- <turtle-svg id="turtle-1" popovertarget="tooltip-1" popovertargetaction="toggle">
            <span slot="title">First</span>
        </turtle-svg> -->
    </section>

    <!-- shown when clicking '#button-bar button' -->
    <!--
    <div id="submenu-1" popover="auto">
        <button>Option A</button><br /><button>Option B</button>
    </div>
    -->

    <!-- element shown when hovering the "popovertarget" on "#button-bar button"-->
    <div id="tooltip-1" class="tooltip" popover="hint">Tooltip A</div>
    <!--
    Press the buttons to show the auto popovers. Hover or focus the buttons to show the hint popovers. When an auto popover is shown, you can show the hint popovers without hiding it.
    ex: https://developer.mozilla.org/en-US/docs/Web/API/Popover_API/Using#using_hint_popover_state
    -->

    <script type="module">
        import { Turtle } from './../../js/turtle.js';
        import { TurtleSvgElement } from './../../js/custom-element/turtle-svg-element.js';
        import { randomInt, elementFromIdOrValue, simpleFormatHtmlWhitespace, simpleEscapeHtml, ColorGenerator } from './../../js/utils.js'
        import { GetAllElements } from './../../js/debug_utils.js'
        import { SvgPathBuilder, CreateElement_Path, CreateElement_Svg, CreateSvgContainerWithTooltip } from './../../js/svg.js'

        window.bag ??= {}
        const parentElement = document.querySelector( ".parent-context" )

        const loggerConfig = {
            mouseEventsAll: true,
            events: {
                mouseout: false,
                mouseover: false,
            }
        }
        window.loggerConfig = loggerConfig

        let cur
        const cg =
            new ColorGenerator( { stepSize: 30, stepInitial: -180 })
            // new ColorGenerator({ stepSize: 10, mode: 'grayscale', stepInitial: 50 })
            // new ColorGenerator({ stepSize: 10, mode: 'grayscale', stepInitial: 50 })
        let i = 0
        let deg = 0
        let path // const newPath = new SvgPathBuilder()
        let curSvgSource
        let pathAttrs = {}
        let rootAttrs = {}

        window.cg ??= cg

        //

        if( true ) { // block mimics the docs
          pathAttrs = {} // { stroke: cg.Next }


            rootAttrs = {}
            rootAttrs = { viewBox: '-1 -1 11 11' }
            function doSquare( size ) {
                // const size = 10
                this
                    .l( size, 0 )
                    .l( 0, size )
                    .l( -size, 0 )
                    .l( 0, -size )
                return this
            }

            path = new SvgPathBuilder().stroke( cg.Next )
                .m( 0, 0 )
                .applyFunc( doSquare, 10  )
                .applyFunc( doSquare, 6.5  )
                .applyFunc( doSquare, 6  )
                .applyFunc( doSquare, 3.5  )
                .applyFunc( doSquare, 2.5  )
                .applyFunc( doSquare, 2  )
                .closePath()

            curSvgSource = CreateSvgContainerWithTooltip( {
                    title: `custom func with params`,
                    path,
                    parentElement,
                }, pathAttrs, rootAttrs )






            pathAttrs = {} // { stroke: cg.Next }
            rootAttrs = {}
            rootAttrs = { viewBox: '-1 -1 11 11' }

            const rectSize = 10

            path = new SvgPathBuilder().stroke( cg.Next )
                // .fill('magenta') // left off: custom verb function rect(), square()
                .m( 0, 0 )
                // .l( rectSize, 0 )
                // .l( 0, rectSize )
                // .l( -rectSize, 0 )
                // .l( 0, -rectSize )
                .closePath()

            function doSquare_noParam( ) {
                // const size = 10
                this
                    .l( rectSize, 0 )
                    .l( 0, rectSize )
                    .l( -rectSize, 0 )
                    .l( 0, -rectSize )
                return this
            }

            path.applyFunc( doSquare_noParam )

            curSvgSource = CreateSvgContainerWithTooltip( {
                    title: `rect( w, h ) using custom verbs`,
                    path,
                    parentElement,
                }, pathAttrs, rootAttrs )






            pathAttrs = {} // { stroke: cg.Next }
            rootAttrs = {}
            rootAttrs = { viewBox: '-1 -1 11 11' }


            path = new SvgPathBuilder().stroke( cg.Next )
                .m( 0, 0 )
                .l( rectSize, 0 )
                .l( 0, rectSize )
                .l( -rectSize, 0 )
                .l( 0, -rectSize )
                .closePath()

            curSvgSource = CreateSvgContainerWithTooltip( {
                    title: `rect( w, h ) defined explicitly`,
                    path,
                    parentElement,
                }, pathAttrs, rootAttrs )






            pathAttrs = {}
            rootAttrs = { viewBox: '0 0 100 100' }
            // pathAttrs = {}
            // rootAttrs = {}

            path = new SvgPathBuilder().stroke( cg.Next )
                // .fill( cg.Next )
                .addPathString( 'M 10 10 L 30 10 L 20 30' )
                .closePath()

            curSvgSource = CreateSvgContainerWithTooltip( {
                    title: `using stroke/fill`,
                    path,
                    parentElement,
                }, pathAttrs, rootAttrs )







            pathAttrs = { }
            rootAttrs = { viewBox: '0 0 100 100' }

            path = new SvgPathBuilder()
                .stroke( cg.Next )
                    // .fill( cg.Next )
                .M( 4, 0 ).H( 50 ).v( 20 ).H( 100 )
                .v( 20 )
                .H( 20 )
                .H( 4 )
                .V( 4 )
                .closePath()


            curSvgSource = CreateSvgContainerWithTooltip( {
                    title: `horizontal/vertical ( absolute  )`,
                    path,
                    parentElement,
                }, pathAttrs, rootAttrs )




            pathAttrs = {  }
            rootAttrs = { viewBox: '0 0 100 100' }

            path = new SvgPathBuilder()
                .stroke( cg.Next )
                    // .fill( cg.Next )
                .M( 10, 10 )
                .horizontal( 20 ).vertical( 20 ).horizontal( -20 )
                .closePath()


            curSvgSource = CreateSvgContainerWithTooltip( {
                    title: `horizontal/vertical ( relative )`,
                    path,
                    parentElement,
                }, pathAttrs, rootAttrs )





            pathAttrs = { }
            rootAttrs = { viewBox: '0 0 400 400' }

            path = new SvgPathBuilder()
                .stroke( cg.Next )
                    // .fill( cg.Next )
            path.addPathString( 'M 100 100 L 300 100 L 200 300 Z' )
            path = new SvgPathBuilder().addPathString( 'M 100 100 L 300 100 L 200 300 Z' )
                .stroke( cg.Next )
                    // .fill( cg.Next )

            curSvgSource = CreateSvgContainerWithTooltip( {
                    title: `triangle ( from string ) `,
                    path,
                    parentElement,
                }, pathAttrs, rootAttrs )



            pathAttrs = {  }
            rootAttrs = { viewBox: '0 0 400 400' }
            path = new SvgPathBuilder()
                .stroke( cg.Next )
                    // .fill( cg.Next )
            path.M( 100, 100 )
                .L( 300, 100 ).L( 200, 300 )
                .closePath()

            curSvgSource = CreateSvgContainerWithTooltip( {
                    title: `triangle ( from calls )`,
                    path,
                    parentElement,
                }, pathAttrs, rootAttrs )


            pathAttrs = {  }
            rootAttrs = { viewBox: '0 0 10 10' }

            path = new SvgPathBuilder()
                .stroke( cg.Next )
                    // .fill( cg.Next )
            path.M( 2 , 2 )
                .L( 8, 2 ).L( 8, 8 ).L( 2, 8 )
                .closePath()

            curSvgSource = CreateSvgContainerWithTooltip( {
                    title: `square2 ( moveto ) abbr`,
                    path,
                    parentElement,
                }, pathAttrs, rootAttrs )



            pathAttrs = {} //  stroke: cg.Next }
            rootAttrs = { viewBox: '0 0 10 10' }
            path = new SvgPathBuilder()
                .stroke( cg.Next )
                    // .fill( cg.Next )
            path.moveAbsolute( 2 , 2 )
                .lineAbsolute( 8, 2 ).lineAbsolute( 8, 8 ).lineAbsolute( 2, 8 ).closePath()

            curSvgSource = CreateSvgContainerWithTooltip( {
                    title: `square ( moveto )`,
                    path,
                    parentElement,
                }, pathAttrs, rootAttrs )
        }
        // cur = NewTurtle( 'original' )
        //     .stroke( cg.Next )
        //     .polygon( ( 1 + i++ ), 3 )
        //     .rotate( 90 * Math.PI / 180 )

        /* page specific handlers for `grid-example.html` */
        const toggleGridSizeButton = document.getElementById( "cmd-btn-toggle-grid-large" );
        toggleGridSizeButton.addEventListener( "click", () => {
            const target = document.querySelector( 'section.parent-context' )
            if ( target.classList.contains( "grid-large" ) ) {
                target.classList.replace( "grid-large", 'grid-small' )
            } else {
                target.classList.remove( "grid-small" )
                target.classList.add( "grid-large" )
            }
        } );
        // tooltips
        const tooltips = document.querySelectorAll( ".tooltip" );
        const btns = document.querySelectorAll( "#button-bar button" );

        function RegisterTooltipsForTurtleSvgElements ( turtleSvgElements ) {
            /**
             * @description Register hover tooltip for each TurtleSvgElement in the NodeList
             * @param {NodeListOf<TurtleSvgElement>} turtleSvgElements
             * @link https://developer.mozilla.org/en-US/docs/Web/API/Popover_API/Using#using_hint_popover_state
             */

            turtleSvgElements.forEach( ( turtleSvgElem ) => {
                turtleSvgElem.addEventListener( "mouseover", () => {
                    const cur_tip = tooltips[ 0 ]
                    if( window.loggerConfig.mouseEventsAll && window.loggerConfig.events.mouseover )  {
                        console.debug( '🐁 MouseOver:', { turtleSvgElem } );
                    }
                    // let cur = turtleSvgElem.shadowRoot.querySelector( 'svg' )
                    const cur = turtleSvgElem.querySelector( 'svg' )
                    const formatted_xml = simpleFormatHtmlWhitespace( cur.outerHTML )
                    const escaped_xml =
                        simpleEscapeHtml( formatted_xml )

                    const abbr_viewBox =
                        cur.getAttribute( 'viewBox' )
                            .split( /\s/ )
                            .map( ( s ) => new Number( s ).toFixed( 1 ) )
                            .join( ' ' )
                    const rawText = `
                    <p>
                    Viewbox: ${ abbr_viewBox }
                    <br/>BaseVal: ${ cur.width.baseVal.value.toFixed( 1 ) } x ${ cur.height.baseVal.value.toFixed( 1 ) }
                    </p>
                    <p>Svg:</p><pre class="inline-code-block"><code class="language-xml">${ escaped_xml
                        }</code></pre>`

                    /* old:
                        <br/>X, Y: ${ cur.getAttribute( 'x' ) }, ${ cur.getAttribute( 'y' ) }.
                        <br/>Width, Height (attr):d ${ cur.getAttribute( 'width' ) } x ${ cur.getAttribute( 'height' ) }.
                    */
                    cur_tip.innerHTML = rawText

                    window.Prism.highlightAll()
                    cur_tip.showPopover( { source: turtleSvgElem } );
                } );

                turtleSvgElem.addEventListener( "mouseout", () => {
                    const cur_tip = tooltips[ 0 ]
                    if( window.loggerConfig.mouseEventsAll && window.loggerConfig.events.mouseout )  {
                        console.debug( '🐁 MouseOut:', { turtleSvgElem } )
                    }
                    cur_tip.hidePopover();
                } );

                turtleSvgElem.addEventListener( "focus", () => {
                    const cur_tip = tooltips[ 0 ]
                    if( window.loggerConfig.mouseEventsAll  )  { console.debug( '🐁 focus:', { turtleSvgElem } ) }
                    cur_tip.showPopover( { source: turtleSvgElem } );
                } );

                turtleSvgElem.addEventListener( "blur", () => {
                    const cur_tip = tooltips[ 0 ]
                    if( window.loggerConfig.mouseEventsAll )  { console.debug( '🐁 blur:', { turtleSvgElem } ) }
                    cur_tip.hidePopover();
                } )

                turtleSvgElem.addEventListener( "click", () => {
                    const cur_tip = tooltips[ 0 ]
                    if( window.loggerConfig.mouseEventsAll )  { console.debug( '🐁 click:', { turtleSvgElem } ) }
                    const rawSvgText = turtleSvgElem.querySelector( 'svg' ).outerHTML
                    console.info( 'copied SVG to clipboard', { rawSvgText } )
                    navigator.clipboard.writeText( rawSvgText )
                        .catch( err => {
                            console.error( 'Failed to copy SVG to clipboard:', err );
                        } )
                } )
            } )
        }
        const all_wrappers = document.querySelectorAll( '.svg-wrapper' )
        RegisterTooltipsForTurtleSvgElements( all_wrappers )

        // globals
        window.bag ??= {}
        window.fn ??= {}
        window.cls ??= {}

        window.Turtle = Turtle
        window.TurtleSvgElement = TurtleSvgElement
        window.bag.root_elem = parentElement
        window.bag.all_wrappers = all_wrappers
        window.fn.allElements = GetAllElements
        window.fn.SvgPathBuilder = SvgPathBuilder
        window.fn.CreateElement_Svg = CreateElement_Svg
        window.fn.CreateElement_Path = CreateElement_Path
        window.cls.ColorGenerator =ColorGenerator


        console.trace( 'debug enabled globals: ', { Turtle, TurtleSvgElement, bag } )

    </script>
    <script src="../../js/prism.js"></script>


</body>

</html>